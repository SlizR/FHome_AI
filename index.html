<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FHome AI - AI for education</title>
    <script src="https://unpkg.com/@google/genai@0.14.0/dist/client-node.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .chat-container {
            width: 100%;
            max-width: 600px;
            height: 90vh;
            background-color: #ffffff;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .chat-header {
            background-color: #3f51b5;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
        }
        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .message {
            max-width: 85%;
            padding: 10px 15px;
            border-radius: 20px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .user-message {
            align-self: flex-end;
            background-color: #c5cae9;
            color: #333;
            border-bottom-right-radius: 5px;
        }
        .ai-message {
            align-self: flex-start;
            background-color: #e8f5e9;
            color: #333;
            border-bottom-left-radius: 5px;
        }
        .chat-input-area {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
            background-color: #fff;
        }
        #userInput {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.3s;
        }
        #userInput:focus {
            border-color: #3f51b5;
        }
        #sendBtn {
            background-color: #3f51b5;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }
        #sendBtn:hover {
            background-color: #303f9f;
        }
        #sendBtn:active {
            transform: scale(0.98);
        }
        .typing-indicator {
            align-self: flex-start;
            padding: 10px 15px;
            font-style: italic;
            color: #888;
            opacity: 0; 
            transition: opacity 0.3s;
        }
        .typing-indicator.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            FHome AI
        </div>
        <div class="chat-messages" id="chatMessages">
            </div>
        <div class="typing-indicator" id="typingIndicator">
            FHome AI writing...
        </div>
        <div class="chat-input-area">
            <input type="text" id="userInput" placeholder="Ask FHome AI anything..." autofocus>
            <button id="sendBtn" disabled>Send</button>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyCX1OUsAj44jYd0BXBQYqatIBJcGpVSyh0"; // This API key was made for AI so that the whole world could use it. If they use it for their own bad deeds, the server will be turned on.
        
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');

        let chat = null;
        let chatHistory = [];
        
        const SPECIAL_RESPONSES = {
            "Name": "My name is **FHome AI**. I'm your personal assistant, ready to help you find information! I was created for educators and people!"
            "Who are you": "My name is **FHome AI**. I'm your personal assistant, ready to help you find information! I was created for educators and people!"
            "Creator": "My creator is **Sliz®**. He developed me to make your life easier and smarter."
            "Who created you": "My creator is **Sliz®**. He developed me to make your life easier and smarter."
        };

        function saveChatHistory(history) {
            localStorage.setItem('fhome_chat_history', JSON.stringify(history));
        }

        function loadChatHistory() {
            const historyString = localStorage.getItem('fhome_chat_history');
            if (historyString) {
                const history = JSON.parse(historyString);
                
                history.forEach(message => {
                    if (message.parts.length > 0) {
                        displayMessage(message.parts[0].text, message.role);
                    }
                });
                
                if (history.length > 2) {
                    displayMessage("Welcome back! Let's continue!", "model");
                }

                return history;
            }
            return [];
        }

        function displayMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'user' ? 'user-message' : 'ai-message'}`;
            
            const htmlText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            messageDiv.innerHTML = htmlText; 
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            typingIndicator.classList.add('visible');
        }

        function hideTypingIndicator() {
            typingIndicator.classList.remove('visible');
        }

        function toggleInput(enabled) {
            userInput.disabled = !enabled;
            sendBtn.disabled = !enabled;
            if (enabled) {
                userInput.focus();
            }
        }

        async function handleSendMessage() {
            const messageText = userInput.value.trim();
            if (!messageText) return;

            toggleInput(false);
            showTypingIndicator();

            displayMessage(messageText, 'user');
            chatHistory.push({ role: "user", parts: [{ text: messageText }] });
            userInput.value = '';

            let aiResponseText = '';

            const normalizedMessage = messageText.toLowerCase();
            let specialFound = false;
            
            for (const keyword in SPECIAL_RESPONSES) {
                if (normalizedMessage.includes(keyword)) {
                    aiResponseText = SPECIAL_RESPONSES[keyword];
                    specialFound = true;
                    break;
                }
            }
            
            if (!specialFound) {
                try {
                    const response = await chat.sendMessage({
                        message: messageText, 
                        tools: [{ googleSearch: {} }] 
                    });

                    aiResponseText = response.text;
                } catch (error) {
                    console.error("API Error:", error);
                    aiResponseText = "Sorry, there was an error connecting to the API. Please try again.";
                }
            }

            displayMessage(aiResponseText, 'model');
            
            if (specialFound) {
                 chatHistory.push({ role: "model", parts: [{ text: aiResponseText.replace(/<\/?b>/g, '') }] });
            } else {
                 chatHistory.push({ role: "model", parts: [{ text: aiResponseText }] });
            }

            saveChatHistory(chatHistory);

            hideTypingIndicator();
            toggleInput(true);
        }
        
        function initializeChat() {
            try {
                const client = new google.genai.Client({ apiKey: API_KEY });

                chatHistory = loadChatHistory();
                
                const systemInstruction = "You are FHome AI, a friendly and intelligent assistant designed to help with information and your smart home. Keep your answers brief and helpful. Always use the same language as the user.";

                chat = client.chats.create({
                    model: 'gemini-2.5-flash',
                    history: chatHistory,
                    config: {
                        systemInstruction: systemInstruction,
                    }
                });

                if (chatHistory.length === 0) {
                    displayMessage("Hi! I'm FHome AI, your smart assistant for education. How can I help you today?", "model");
                }
                
                sendBtn.disabled = false;
                
            } catch (e) {
                console.error("API initialization error:", e);
                displayMessage(`Error: Failed to initialize the API. Check your internet connection.`, "model");
            }
        }

        sendBtn.addEventListener('click', handleSendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendBtn.disabled) {
                handleSendMessage();
            }
        });
        
        window.onload = initializeChat;
    </script>
</body>
</html>
